

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Basic demo &#8212; OpenSCM-Calibration Examples</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="application/vnd.jupyter.widget-state+json">{"state": {"7870c5a4da5a48aab0bc91b82f79f8c0": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "2f8f63a812934b1d8e1beb7f43c78ba0": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "43dc3171185c40bea05495199008f708": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "danger", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_7870c5a4da5a48aab0bc91b82f79f8c0", "max": 612.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_2f8f63a812934b1d8e1beb7f43c78ba0", "tabbable": null, "tooltip": null, "value": 168.0}}, "135e9d1480d14ca1ab25bb723c56700e": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "385a8641c2d64863b8da9d35226e1cdd": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "c6fe0b83f7474b5ba6a9879a215acf91": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_135e9d1480d14ca1ab25bb723c56700e", "placeholder": "\u200b", "style": "IPY_MODEL_385a8641c2d64863b8da9d35226e1cdd", "tabbable": null, "tooltip": null, "value": " 27%"}}, "0d69f6b4bf4648d7acea19ef89c4a530": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "9476bdc46bba4b2b9783fdbcb3f5c8ec": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "6d52fecf2f124d9bb43616e42116ea92": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_0d69f6b4bf4648d7acea19ef89c4a530", "placeholder": "\u200b", "style": "IPY_MODEL_9476bdc46bba4b2b9783fdbcb3f5c8ec", "tabbable": null, "tooltip": null, "value": " 168/612 [00:29&lt;01:29,  4.94it/s]"}}, "4e5b7912ad1b416d8fab181b9be6d0ed": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "fcb35dcaf8284219b1720aec6db24de4": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_c6fe0b83f7474b5ba6a9879a215acf91", "IPY_MODEL_43dc3171185c40bea05495199008f708", "IPY_MODEL_6d52fecf2f124d9bb43616e42116ea92"], "layout": "IPY_MODEL_4e5b7912ad1b416d8fab181b9be6d0ed", "tabbable": null, "tooltip": null}}, "0420ccc6036b4600adea1b6663f7b075": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "966a07993cff4cbd94f2008bf84a1f36": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "230b37fde65741908fa1086bb200f454": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "danger", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_0420ccc6036b4600adea1b6663f7b075", "max": 603.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_966a07993cff4cbd94f2008bf84a1f36", "tabbable": null, "tooltip": null, "value": 94.0}}, "ab9f48cf1c324b2f8066d68e1a3bd9c5": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "01943d5727184535860dadd42f10182a": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "bd43f7097a3f40a386ed291613fd6c83": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_ab9f48cf1c324b2f8066d68e1a3bd9c5", "placeholder": "\u200b", "style": "IPY_MODEL_01943d5727184535860dadd42f10182a", "tabbable": null, "tooltip": null, "value": " 16%"}}, "8b83309d7a9644608e6b3b3bf34aed97": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "77b16b0fb0f14cb7944e0632e524c8bc": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "93446111dee3404bad345c46cf5208c0": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_8b83309d7a9644608e6b3b3bf34aed97", "placeholder": "\u200b", "style": "IPY_MODEL_77b16b0fb0f14cb7944e0632e524c8bc", "tabbable": null, "tooltip": null, "value": " 94/603 [00:15&lt;01:06,  7.65it/s]"}}, "609f0263a85a449da6e85911a617b345": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "57ae7d0a1d544bcfb9dac7aff160e655": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_bd43f7097a3f40a386ed291613fd6c83", "IPY_MODEL_230b37fde65741908fa1086bb200f454", "IPY_MODEL_93446111dee3404bad345c46cf5208c0"], "layout": "IPY_MODEL_609f0263a85a449da6e85911a617b345", "tabbable": null, "tooltip": null}}, "6ff1ddec41c44221bee490d2c1941fd9": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "833029f25a1e426eb468995b27051d90": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "3a080d3d0ca34d869ee1c2652c2b4c8b": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_6ff1ddec41c44221bee490d2c1941fd9", "max": 900.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_833029f25a1e426eb468995b27051d90", "tabbable": null, "tooltip": null, "value": 900.0}}, "b139d35fe6e04f578c624e430d52ddf5": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "2b0a78b84b574a0a853dbf554075490a": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "ddd344d7f5514f4e98916cc95a871055": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_b139d35fe6e04f578c624e430d52ddf5", "placeholder": "\u200b", "style": "IPY_MODEL_2b0a78b84b574a0a853dbf554075490a", "tabbable": null, "tooltip": null, "value": "100%"}}, "6db55598858d4c6281ef65ea7637a3fa": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "06bf981e8f9a465090e4c7ecddf0fcd7": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "920aeb5af84b4e63bed8dde2e0313375": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_6db55598858d4c6281ef65ea7637a3fa", "placeholder": "\u200b", "style": "IPY_MODEL_06bf981e8f9a465090e4c7ecddf0fcd7", "tabbable": null, "tooltip": null, "value": " 900/900 [10:30&lt;00:00,  1.54it/s]"}}, "53a64b33b13f42b5bc0631e9c6f0b827": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "589510770f9e4d62b64413c40f878567": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_ddd344d7f5514f4e98916cc95a871055", "IPY_MODEL_3a080d3d0ca34d869ee1c2652c2b4c8b", "IPY_MODEL_920aeb5af84b4e63bed8dde2e0313375"], "layout": "IPY_MODEL_53a64b33b13f42b5bc0631e9c6f0b827", "tabbable": null, "tooltip": null}}, "1458cddfa24d4797a6450f395c59f4a6": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "aebea6d7be4a4ced8065f67a0a5bfa65": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "b1e172507ee64c29aebe6e8881ee9ac1": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_1458cddfa24d4797a6450f395c59f4a6", "max": 900.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_aebea6d7be4a4ced8065f67a0a5bfa65", "tabbable": null, "tooltip": null, "value": 900.0}}, "ab580216aa0a4cb3beb9ef5c4e52990d": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "3bfb78654a144c5aa966546efa678fc0": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "38a14034e83a4e369d440b5ff74b46e8": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_ab580216aa0a4cb3beb9ef5c4e52990d", "placeholder": "\u200b", "style": "IPY_MODEL_3bfb78654a144c5aa966546efa678fc0", "tabbable": null, "tooltip": null, "value": "100%"}}, "0e40cc8e10ab40dda648447965185e95": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "afc8e373840c425a84dc5546fa490b23": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "30198d83313b4196bfeeb05510e4c146": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_0e40cc8e10ab40dda648447965185e95", "placeholder": "\u200b", "style": "IPY_MODEL_afc8e373840c425a84dc5546fa490b23", "tabbable": null, "tooltip": null, "value": " 900/900 [10:50&lt;00:00,  1.53it/s]"}}, "9e943b446f6246288148e55ba5c346b3": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "65f9b797855f4867960641e1bd5dea4a": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_38a14034e83a4e369d440b5ff74b46e8", "IPY_MODEL_b1e172507ee64c29aebe6e8881ee9ac1", "IPY_MODEL_30198d83313b4196bfeeb05510e4c146"], "layout": "IPY_MODEL_9e943b446f6246288148e55ba5c346b3", "tabbable": null, "tooltip": null}}}, "version_major": 2, "version_minor": 0}</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script crossorigin="anonymous" data-jupyter-widgets-cdn="https://cdn.jsdelivr.net/npm/" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.6/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/basic-demo';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="OpenSCM-Calibration Examples" href="../intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    <p class="title logo__title">OpenSCM-Calibration Examples</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    OpenSCM-Calibration Examples
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Basic demo</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/openscm/openscm-calibration_examples" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/openscm/openscm-calibration_examples/issues/new?title=Issue%20on%20page%20%2Fnotebooks/basic-demo.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/basic-demo.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Basic demo</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#experiments">Experiments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#target">Target</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cost-calculation">Cost calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-runner">Model runner</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-optimisation">Global optimisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#local-optimisation">Local optimisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mcmc">MCMC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prior">Prior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#likelihood-and-prior">Likelihood and prior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proposal">Proposal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run">Run</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-a-live-run">Plotting a live run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-degeneracy">Adding degeneracy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#re-running-the-mcmc">Re-running the MCMC</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="basic-demo">
<h1>Basic demo<a class="headerlink" href="#basic-demo" title="Permalink to this heading">#</a></h1>
<p>Here we give a basic demo of how to work with OpenSCM-Calibration. However, we run it for long enough that the results are meaningful and interesting.</p>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">emcee</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">more_itertools</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.testing</span> <span class="k">as</span> <span class="nn">npt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pint</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span>
<span class="kn">import</span> <span class="nn">scmdata.run</span>
<span class="kn">from</span> <span class="nn">emcwrap</span> <span class="kn">import</span> <span class="n">DIMEMove</span>
<span class="kn">from</span> <span class="nn">multiprocess</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">Manager</span>
<span class="kn">from</span> <span class="nn">openscm_units</span> <span class="kn">import</span> <span class="n">unit_registry</span> <span class="k">as</span> <span class="n">UREG</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">import</span> <span class="nn">openscm_calibration</span>
<span class="kn">from</span> <span class="nn">openscm_calibration</span> <span class="kn">import</span> <span class="n">emcee_plotting</span>
<span class="kn">from</span> <span class="nn">openscm_calibration.cost</span> <span class="kn">import</span> <span class="n">OptCostCalculatorSSE</span>
<span class="kn">from</span> <span class="nn">openscm_calibration.emcee_utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_acceptance_fractions</span><span class="p">,</span>
    <span class="n">get_autocorrelation_info</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">openscm_calibration.minimize</span> <span class="kn">import</span> <span class="n">to_minimize_full</span>
<span class="kn">from</span> <span class="nn">openscm_calibration.model_runner</span> <span class="kn">import</span> <span class="n">OptModelRunner</span>
<span class="kn">from</span> <span class="nn">openscm_calibration.scipy_plotting</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CallbackProxy</span><span class="p">,</span>
    <span class="n">OptPlotter</span><span class="p">,</span>
    <span class="n">get_ymax_default</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">openscm_calibration.scmdata_utils</span> <span class="kn">import</span> <span class="n">scmrun_as_dict</span>
<span class="kn">from</span> <span class="nn">openscm_calibration.store</span> <span class="kn">import</span> <span class="n">OptResStore</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/OpenSCM-Calibration_examples/OpenSCM-Calibration_examples/.venv/lib/python3.9/site-packages/scmdata/database/_database.py:9: TqdmExperimentalWarning: Using `tqdm.autonotebook.tqdm` in notebook mode. Use `tqdm.tqdm` instead to force console mode (e.g. in jupyter console)
  import tqdm.autonotebook as tqdman
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">openscm_calibration</span><span class="o">.</span><span class="n">__version__</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>openscm_calibration.__version__=&#39;0.5.0&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<p>In this notebook were going to run a simple model to solve the following equation for the motion of a mass on a damped spring</p>
<p>\begin{align*}
v &amp;= \frac{dx}{dt} \
m \frac{dv}{dt} &amp;= -k (x - x_0) - \beta v
\end{align*}</p>
<p>where <span class="math notranslate nohighlight">\(v\)</span> is the velocity of the mass, <span class="math notranslate nohighlight">\(x\)</span> is the position of the mass, <span class="math notranslate nohighlight">\(t\)</span> is time, <span class="math notranslate nohighlight">\(m\)</span> is the mass of the mass, <span class="math notranslate nohighlight">\(k\)</span> is the spring constant, <span class="math notranslate nohighlight">\(x_0\)</span> is the equilibrium position and <span class="math notranslate nohighlight">\(\beta\)</span> is a damping constant.</p>
<p>We are going to solve this system using <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html">scipys solve initial value problem</a>.</p>
<p>We want to support units, so we implement this using <a class="reference external" href="https://pint.readthedocs.io/">pint</a>.</p>
</section>
<section id="experiments">
<h2>Experiments<a class="headerlink" href="#experiments" title="Permalink to this heading">#</a></h2>
<p>Were going to calibrate the models response in two experiments:</p>
<ul class="simple">
<li><p>starting out of equilibrium</p></li>
<li><p>starting at the equilibrium position but already moving</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LENGTH_UNITS</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span>
<span class="n">MASS_UNITS</span> <span class="o">=</span> <span class="s2">&quot;Pt&quot;</span>
<span class="n">TIME_UNITS</span> <span class="o">=</span> <span class="s2">&quot;yr&quot;</span>
<span class="n">time_axis</span> <span class="o">=</span> <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1850</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">TIME_UNITS</span><span class="p">)</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">MASS_UNITS</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_experiments_full</span><span class="p">(</span>
    <span class="n">k</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">x_zero</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">scmdata</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">BaseScmRun</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run model experiments</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k</span>
<span class="sd">        Spring constant [kg / s^2]</span>

<span class="sd">    x_zero</span>
<span class="sd">        Equilibrium position [m]</span>

<span class="sd">    beta</span>
<span class="sd">        Damping constant [kg / s]</span>

<span class="sd">    m</span>
<span class="sd">        Mass [kg]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        Results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Avoiding pint conversions in the function actually</span>
    <span class="c1"># being solved makes things much faster, but also</span>
    <span class="c1"># harder to keep track of. We recommend starting with</span>
    <span class="c1"># pint everywhere first, then optimising second (either</span>
    <span class="c1"># via using numpy quantities throughout, optional numpy</span>
    <span class="c1"># quantities using e.g. pint.wrap or using Fortran or</span>
    <span class="c1"># C wrappers).</span>
    <span class="n">k_m</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MASS_UNITS</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">TIME_UNITS</span><span class="si">}</span><span class="s2">^2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">m</span>
    <span class="n">x_zero_m</span> <span class="o">=</span> <span class="n">x_zero</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">LENGTH_UNITS</span><span class="p">)</span><span class="o">.</span><span class="n">m</span>
    <span class="n">beta_m</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MASS_UNITS</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">TIME_UNITS</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">m</span>
    <span class="n">m_m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">MASS_UNITS</span><span class="p">)</span><span class="o">.</span><span class="n">m</span>

    <span class="k">def</span> <span class="nf">to_solve</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Right-hand side of our equation i.e. dN/dt</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t</span>
<span class="sd">            time</span>

<span class="sd">        y</span>
<span class="sd">            Current stat of the system</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            dN/dt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">dv_dt</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">k_m</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_zero_m</span><span class="p">)</span> <span class="o">-</span> <span class="n">beta_m</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">m_m</span>
        <span class="n">dx_dt</span> <span class="o">=</span> <span class="n">v</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dx_dt</span><span class="p">,</span> <span class="n">dv_dt</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">time_axis_m</span> <span class="o">=</span> <span class="n">time_axis</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">TIME_UNITS</span><span class="p">)</span><span class="o">.</span><span class="n">m</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">to_solve_l</span><span class="p">,</span> <span class="n">x_start</span><span class="p">,</span> <span class="n">v_start</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="p">(</span>
            <span class="s2">&quot;non-eqm-start&quot;</span><span class="p">,</span>
            <span class="n">to_solve</span><span class="p">,</span>
            <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">),</span>
            <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;m / s&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;eqm-start&quot;</span><span class="p">,</span> <span class="n">to_solve</span><span class="p">,</span> <span class="n">x_zero</span><span class="p">,</span> <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;m / yr&quot;</span><span class="p">)),</span>
    <span class="p">):</span>
        <span class="n">res</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span>
            <span class="n">to_solve_l</span><span class="p">,</span>
            <span class="n">t_span</span><span class="o">=</span><span class="p">[</span><span class="n">time_axis_m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_axis_m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">y0</span><span class="o">=</span><span class="p">[</span>
                <span class="n">x_start</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">LENGTH_UNITS</span><span class="p">)</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
                <span class="n">v_start</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">LENGTH_UNITS</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">TIME_UNITS</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">t_eval</span><span class="o">=</span><span class="n">time_axis_m</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Model failed to solve&quot;</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">scmdata</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">BaseScmRun</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;non-eqm-start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;eqm-start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]]),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">LENGTH_UNITS</span><span class="p">,</span> <span class="n">LENGTH_UNITS</span><span class="p">],</span>
                    <span class="p">[</span><span class="s2">&quot;non-eqm-start&quot;</span><span class="p">,</span> <span class="s2">&quot;eqm-start&quot;</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="s2">&quot;scenario&quot;</span><span class="p">],</span>
            <span class="p">),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">time_axis</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">TIME_UNITS</span><span class="p">)</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;example&quot;</span>

    <span class="k">return</span> <span class="n">out</span>


<span class="n">do_experiments</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">do_experiments_full</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">mass</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="target">
<h3>Target<a class="headerlink" href="#target" title="Permalink to this heading">#</a></h3>
<p>For this example, were going to use a known configuration as our target so we can make sure that we optimise to the right spot. In practice, we wont know the correct answer before we start so this setup will generally look a bit different (typically we would be loading data from some other source to which we want to calibrate).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">truth</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="s2">&quot;kg / s^2&quot;</span><span class="p">),</span>
    <span class="s2">&quot;x_zero&quot;</span><span class="p">:</span> <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">),</span>
    <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1e11</span><span class="p">,</span> <span class="s2">&quot;kg / s&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">target</span> <span class="o">=</span> <span class="n">do_experiments</span><span class="p">(</span><span class="o">**</span><span class="n">truth</span><span class="p">)</span>
<span class="n">target</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span>
<span class="n">target</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">time_axis</span><span class="o">=</span><span class="s2">&quot;year-month&quot;</span><span class="p">)</span>
<span class="n">target</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/OpenSCM-Calibration_examples/OpenSCM-Calibration_examples/.venv/lib/python3.9/site-packages/scmdata/plotting.py:79: FutureWarning: 

The `ci` parameter is deprecated. Use `errorbar=&#39;sd&#39;` for the same effect.

  ax = sns.lineplot(data=plt_df, **kwargs)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;BaseScmRun (timeseries: 2, timepoints: 150)&gt;
Time:
	Start: 1850-01-01T00:00:00
	End: 1999-01-01T00:00:00
Meta:
	    model       scenario unit  variable
	0  target  non-eqm-start    m  position
	1  target      eqm-start    m  position
</pre></div>
</div>
<img alt="../_images/79a749231f917ccce6c7f36d5d1b7dcdf8c3eab611ff87d992959f40b5577efa.png" src="../_images/79a749231f917ccce6c7f36d5d1b7dcdf8c3eab611ff87d992959f40b5577efa.png" />
</div>
</div>
</section>
<section id="cost-calculation">
<h3>Cost calculation<a class="headerlink" href="#cost-calculation" title="Permalink to this heading">#</a></h3>
<p>The next thing is to decide how were going to calculate the cost function. There are many options here, in this case were going to use the sum of squared errors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">normalisation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
    <span class="p">[</span><span class="mf">0.1</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;position&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">],</span>
        <span class="p">),</span>
        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">],</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">cost_calculator</span> <span class="o">=</span> <span class="n">OptCostCalculatorSSE</span><span class="o">.</span><span class="n">from_series_normalisation</span><span class="p">(</span>
    <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">normalisation_series</span><span class="o">=</span><span class="n">normalisation</span><span class="p">,</span> <span class="n">model_col</span><span class="o">=</span><span class="s2">&quot;model&quot;</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">cost_calculator</span><span class="o">.</span><span class="n">calculate_cost</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
<span class="k">assert</span> <span class="n">cost_calculator</span><span class="o">.</span><span class="n">calculate_cost</span><span class="p">(</span><span class="n">target</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">cost_calculator</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OptCostCalculatorSSE(target=&lt;BaseScmRun (timeseries: 2, timepoints: 150)&gt;
Time:
	Start: 1850-01-01T00:00:00
	End: 1999-01-01T00:00:00
Meta:
	    model       scenario unit  variable
	0  target  non-eqm-start    m  position
	1  target      eqm-start    m  position, model_col=&#39;model&#39;, normalisation=&lt;BaseScmRun (timeseries: 2, timepoints: 150)&gt;
Time:
	Start: 1850-01-01T00:00:00
	End: 1999-01-01T00:00:00
Meta:
	    model       scenario unit  variable
	0  target  non-eqm-start    m  position
	1  target      eqm-start    m  position)
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-runner">
<h3>Model runner<a class="headerlink" href="#model-runner" title="Permalink to this heading">#</a></h3>
<p>Scipy does everything using numpy arrays. Here we use a wrapper that converts them to pint quantities before running.</p>
<p>Firstly, we define the parameters were going to optimise. This will be used to ensure a consistent order throughout.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MASS_UNITS</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">TIME_UNITS</span><span class="si">}</span><span class="s2"> ^ 2&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;x_zero&quot;</span><span class="p">,</span> <span class="n">LENGTH_UNITS</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MASS_UNITS</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">TIME_UNITS</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">parameters</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;k&#39;, &#39;Pt / yr ^ 2&#39;), (&#39;x_zero&#39;, &#39;m&#39;), (&#39;beta&#39;, &#39;Pt / yr&#39;)]
</pre></div>
</div>
</div>
</div>
<p>Next we define a function which, given pint quantities, returns the inputs needed for our <code class="docutils literal notranslate"><span class="pre">do_experiments</span></code> function. In this case this is not a very interesting function, but in other use cases the flexibility is helpful.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_model_runs_input_generator</span><span class="p">(</span>
    <span class="n">k</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">x_zero</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the inputs for :func:`do_experiments`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k</span>
<span class="sd">        k</span>

<span class="sd">    x_zero</span>
<span class="sd">        x_zero</span>

<span class="sd">    beta</span>
<span class="sd">        beta</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        Inputs for :func:`do_experiments`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;x_zero&quot;</span><span class="p">:</span> <span class="n">x_zero</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="n">beta</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_runner</span> <span class="o">=</span> <span class="n">OptModelRunner</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span>
    <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
    <span class="n">do_model_runs_input_generator</span><span class="o">=</span><span class="n">do_model_runs_input_generator</span><span class="p">,</span>
    <span class="n">do_model_runs</span><span class="o">=</span><span class="n">do_experiments</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">model_runner</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OptModelRunner(convert_x_to_names_with_units=functools.partial(&lt;function x_and_parameters_to_named_with_units at 0x7f2db97edee0&gt;, params=[(&#39;k&#39;, &#39;Pt / yr ^ 2&#39;), (&#39;x_zero&#39;, &#39;m&#39;), (&#39;beta&#39;, &#39;Pt / yr&#39;)]), do_model_runs_input_generator=&lt;function do_model_runs_input_generator at 0x7f2db85f8550&gt;, do_model_runs=functools.partial(&lt;function do_experiments_full at 0x7f2db980b280&gt;, m=&lt;Quantity(100, &#39;petametric_ton&#39;)&gt;))
</pre></div>
</div>
</div>
</div>
<p>Now we can run from a plain numpy array (like scipy will use) and get a result that will be understood by our cost calculator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cost_calculator</span><span class="o">.</span><span class="n">calculate_cost</span><span class="p">(</span><span class="n">model_runner</span><span class="o">.</span><span class="n">run_model</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.48082272283305
</pre></div>
</div>
</div>
</div>
<p>Now were ready to optimise.</p>
</section>
</section>
<section id="global-optimisation">
<h2>Global optimisation<a class="headerlink" href="#global-optimisation" title="Permalink to this heading">#</a></h2>
<p>Scipy has many <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.html#global-optimization">global optimisation options</a>. Here we show how to do this with differential evolution, but using others would be equally simple.</p>
<p>We have to define where to start the optimisation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">start</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([4. , 0.6, 2. ])
</pre></div>
</div>
</div>
</div>
<p>For this optimisation, we must also define bounds for each parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bounds_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;kg / s^2&quot;</span><span class="p">),</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1e4</span><span class="p">,</span> <span class="s2">&quot;kg / s^2&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;x_zero&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">),</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1e10</span><span class="p">,</span> <span class="s2">&quot;kg / s&quot;</span><span class="p">),</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1e12</span><span class="p">,</span> <span class="s2">&quot;kg / s&quot;</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">}</span>
<span class="n">display</span><span class="p">(</span><span class="n">bounds_dict</span><span class="p">)</span>

<span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bounds_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>
<span class="n">bounds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;k&#39;: [300 &lt;Unit(&#39;kilogram / second ** 2&#39;)&gt;,
  10000.0 &lt;Unit(&#39;kilogram / second ** 2&#39;)&gt;],
 &#39;x_zero&#39;: [-2 &lt;Unit(&#39;meter&#39;)&gt;, 2 &lt;Unit(&#39;meter&#39;)&gt;],
 &#39;beta&#39;: [10000000000.0 &lt;Unit(&#39;kilogram / second&#39;)&gt;,
  1000000000000.0 &lt;Unit(&#39;kilogram / second&#39;)&gt;]}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0.298764635328, 9.9588211776], [-2, 2], [0.315576, 31.557600000000004]]
</pre></div>
</div>
</div>
</div>
<p>Now were ready to run our optimisation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of parallel processes to use</span>
<span class="n">processes</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Random seed (use if you want reproducibility)</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">374839</span>

<span class="c1">## Optimisation parameters</span>
<span class="c1"># Tolerance to set for convergance</span>
<span class="n">atol</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="c1"># Maximum number of iterations to use</span>
<span class="n">maxiter</span> <span class="o">=</span> <span class="mi">50</span>
<span class="c1"># Lower mutation means faster convergence but smaller</span>
<span class="c1"># search radius</span>
<span class="n">mutation</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="c1"># Higher recombination means faster convergence but</span>
<span class="c1"># might miss global minimum</span>
<span class="n">recombination</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="c1"># Size of population to use (higher number means more searching</span>
<span class="c1"># but slower convergence)</span>
<span class="n">popsize</span> <span class="o">=</span> <span class="mi">4</span>
<span class="c1"># There are also the strategy and init options</span>
<span class="c1"># which might be needed for some problems</span>

<span class="c1"># Maximum number of runs to store</span>
<span class="n">max_n_runs</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxiter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">popsize</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>


<span class="c1"># Visualisation options</span>
<span class="n">update_every</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">thin_ts_to_plot</span> <span class="o">=</span> <span class="mi">5</span>


<span class="c1"># Create axes to plot on (could also be created as part of a factory</span>
<span class="c1"># or class method)</span>
<span class="n">convert_scmrun_to_plot_dict</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">scmrun_as_dict</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;scenario&quot;</span><span class="p">])</span>

<span class="n">cost_name</span> <span class="o">=</span> <span class="s2">&quot;cost&quot;</span>
<span class="n">timeseries_axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">convert_scmrun_to_plot_dict</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">parameters_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>
<span class="n">parameters_mosiac</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">more_itertools</span><span class="o">.</span><span class="n">repeat_each</span><span class="p">(</span><span class="n">parameters_names</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">timeseries_axes_mosiac</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">more_itertools</span><span class="o">.</span><span class="n">repeat_each</span><span class="p">(</span><span class="n">timeseries_axes</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axd</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span>
    <span class="n">mosaic</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="n">cost_name</span><span class="p">]</span> <span class="o">+</span> <span class="n">timeseries_axes_mosiac</span><span class="p">,</span>
        <span class="n">parameters_mosiac</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">holder</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">with</span> <span class="n">Manager</span><span class="p">()</span> <span class="k">as</span> <span class="n">manager</span><span class="p">:</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">OptResStore</span><span class="o">.</span><span class="n">from_n_runs_manager</span><span class="p">(</span>
        <span class="n">max_n_runs</span><span class="p">,</span>
        <span class="n">manager</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">parameters_names</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create objects and functions to use</span>
    <span class="n">to_minimize</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">to_minimize_full</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span>
        <span class="n">cost_calculator</span><span class="o">=</span><span class="n">cost_calculator</span><span class="p">,</span>
        <span class="n">model_runner</span><span class="o">=</span><span class="n">model_runner</span><span class="p">,</span>
        <span class="n">known_error</span><span class="o">=</span><span class="ne">ValueError</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">manager</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">max_n_runs</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">opt_plotter</span> <span class="o">=</span> <span class="n">OptPlotter</span><span class="p">(</span>
                <span class="n">holder</span><span class="o">=</span><span class="n">holder</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
                <span class="n">axes</span><span class="o">=</span><span class="n">axd</span><span class="p">,</span>
                <span class="n">cost_key</span><span class="o">=</span><span class="n">cost_name</span><span class="p">,</span>
                <span class="n">parameters</span><span class="o">=</span><span class="n">parameters_names</span><span class="p">,</span>
                <span class="n">timeseries_axes</span><span class="o">=</span><span class="n">timeseries_axes</span><span class="p">,</span>
                <span class="n">convert_scmrun_to_plot_dict</span><span class="o">=</span><span class="n">convert_scmrun_to_plot_dict</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
                <span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span>
                <span class="n">thin_ts_to_plot</span><span class="o">=</span><span class="n">thin_ts_to_plot</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">proxy</span> <span class="o">=</span> <span class="n">CallbackProxy</span><span class="p">(</span>
                <span class="n">real_callback</span><span class="o">=</span><span class="n">opt_plotter</span><span class="p">,</span>
                <span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span>
                <span class="n">update_every</span><span class="o">=</span><span class="n">update_every</span><span class="p">,</span>
                <span class="n">progress_bar</span><span class="o">=</span><span class="n">pbar</span><span class="p">,</span>
                <span class="n">last_callback_val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">optimize_res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span>
                <span class="n">to_minimize</span><span class="p">,</span>
                <span class="n">bounds</span><span class="p">,</span>
                <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                <span class="n">x0</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
                <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                <span class="c1"># Polish as a second step if you want</span>
                <span class="n">polish</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">workers</span><span class="o">=</span><span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">,</span>
                <span class="n">updating</span><span class="o">=</span><span class="s2">&quot;deferred&quot;</span><span class="p">,</span>  <span class="c1"># as we run in parallel, this has to be used</span>
                <span class="n">mutation</span><span class="o">=</span><span class="n">mutation</span><span class="p">,</span>
                <span class="n">recombination</span><span class="o">=</span><span class="n">recombination</span><span class="p">,</span>
                <span class="n">popsize</span><span class="o">=</span><span class="n">popsize</span><span class="p">,</span>
                <span class="n">callback</span><span class="o">=</span><span class="n">proxy</span><span class="o">.</span><span class="n">callback_differential_evolution</span><span class="p">,</span>
            <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">optimize_res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8a276baff2ace4a2e04c56daec27872fe3213091e99a05354ef6f81bde1ad0e4.png" src="../_images/8a276baff2ace4a2e04c56daec27872fe3213091e99a05354ef6f81bde1ad0e4.png" />
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "fcb35dcaf8284219b1720aec6db24de4"}</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: 45.72328578101859
 message: &#39;Optimization terminated successfully.&#39;
    nfev: 168
     nit: 13
 success: True
       x: array([3.02972562, 0.46913996, 3.10801773])
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show the assertion we use in testing</span>
<span class="expanded">Hide the assertion we use in testing</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">optimize_res</span><span class="o">.</span><span class="n">success</span>
<span class="n">npt</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">optimize_res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mf">3.030</span><span class="p">,</span> <span class="mf">0.469</span><span class="p">,</span> <span class="mf">3.108</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="local-optimisation">
<h2>Local optimisation<a class="headerlink" href="#local-optimisation" title="Permalink to this heading">#</a></h2>
<p>Scipy also has <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.html#local-multivariate-optimization">local optimisation</a> (e.g. Nelder-Mead) options. Here we show how to do this.</p>
<p>Again, we have to define where to start the optimisation (this has a greater effect on local optimisation).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The typical way to do local optimisation is to polish</span>
<span class="c1"># the results of a more global optimisation like differential</span>
<span class="c1"># evolution above. We do that here, but you could also use a</span>
<span class="c1"># random start too</span>
<span class="n">start_local</span> <span class="o">=</span> <span class="n">optimize_res</span><span class="o">.</span><span class="n">x</span>
<span class="n">start_local</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3.02972562, 0.46913996, 3.10801773])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optimisation parameters</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-4</span>
<span class="c1"># Maximum number of iterations to use</span>
<span class="n">maxiter</span> <span class="o">=</span> <span class="mi">300</span>

<span class="c1"># I think this is how this works</span>
<span class="n">max_n_runs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">maxiter</span>

<span class="c1"># Lots of options here</span>
<span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;Nelder-mead&quot;</span>

<span class="c1"># Visualisation options</span>
<span class="n">update_every</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">thin_ts_to_plot</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">parameters_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>

<span class="c1"># Create other objects</span>
<span class="n">store</span> <span class="o">=</span> <span class="n">OptResStore</span><span class="o">.</span><span class="n">from_n_runs</span><span class="p">(</span><span class="n">max_n_runs</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters_names</span><span class="p">)</span>
<span class="n">to_minimize</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
    <span class="n">to_minimize_full</span><span class="p">,</span>
    <span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span>
    <span class="n">cost_calculator</span><span class="o">=</span><span class="n">cost_calculator</span><span class="p">,</span>
    <span class="n">model_runner</span><span class="o">=</span><span class="n">model_runner</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">max_n_runs</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
    <span class="c1"># Here we use a class method which auto-generates the figure</span>
    <span class="c1"># for us. This is just a convenience thing, it does the same</span>
    <span class="c1"># thing as the previous example under the hood.</span>
    <span class="n">opt_plotter</span> <span class="o">=</span> <span class="n">OptPlotter</span><span class="o">.</span><span class="n">from_autogenerated_figure</span><span class="p">(</span>
        <span class="n">cost_key</span><span class="o">=</span><span class="n">cost_name</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">parameters_names</span><span class="p">,</span>
        <span class="n">convert_scmrun_to_plot_dict</span><span class="o">=</span><span class="n">convert_scmrun_to_plot_dict</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span>
        <span class="n">thin_ts_to_plot</span><span class="o">=</span><span class="n">thin_ts_to_plot</span><span class="p">,</span>
        <span class="n">kwargs_create_mosaic</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">n_parameters_per_row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">n_timeseries_per_row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">cost_col_relwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">kwargs_get_fig_axes_holder</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
        <span class="n">plot_cost_kwargs</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
            <span class="s2">&quot;get_ymax&quot;</span><span class="p">:</span> <span class="n">partial</span><span class="p">(</span>
                <span class="n">get_ymax_default</span><span class="p">,</span> <span class="n">min_scale_factor</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">min_v_median_scale_factor</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">),</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="n">proxy</span> <span class="o">=</span> <span class="n">CallbackProxy</span><span class="p">(</span>
        <span class="n">real_callback</span><span class="o">=</span><span class="n">opt_plotter</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span>
        <span class="n">update_every</span><span class="o">=</span><span class="n">update_every</span><span class="p">,</span>
        <span class="n">progress_bar</span><span class="o">=</span><span class="n">pbar</span><span class="p">,</span>
        <span class="n">last_callback_val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">optimize_res_local</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
        <span class="n">to_minimize</span><span class="p">,</span>
        <span class="n">x0</span><span class="o">=</span><span class="n">start_local</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="n">maxiter</span><span class="p">},</span>
        <span class="n">callback</span><span class="o">=</span><span class="n">proxy</span><span class="o">.</span><span class="n">callback_minimize</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">optimize_res_local</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "57ae7d0a1d544bcfb9dac7aff160e655"}</script><img alt="../_images/36f8460e4368ab525fa088c7ed43c3485eb79a57cdf0c664a133a79a2585c2a2.png" src="../_images/36f8460e4368ab525fa088c7ed43c3485eb79a57cdf0c664a133a79a2585c2a2.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> final_simplex: (array([[2.98764573, 0.50000399, 3.15576414],
       [2.98764759, 0.50000064, 3.15570193],
       [2.98763154, 0.49999956, 3.15575025],
       [2.98764986, 0.49999085, 3.15582127]]), array([5.13150957e-07, 8.05891938e-07, 1.83189480e-06, 3.34335609e-06]))
           fun: 5.131509568272215e-07
       message: &#39;Optimization terminated successfully.&#39;
          nfev: 94
           nit: 49
        status: 0
       success: True
             x: array([2.98764573, 0.50000399, 3.15576414])
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show the assertion we use in testing</span>
<span class="expanded">Hide the assertion we use in testing</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">optimize_res_local</span><span class="o">.</span><span class="n">success</span>
<span class="n">npt</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">optimize_res_local</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.988</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">,</span> <span class="mf">3.156</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="mcmc">
<h2>MCMC<a class="headerlink" href="#mcmc" title="Permalink to this heading">#</a></h2>
<p>To run MCMC, we use the <a class="reference external" href="https://emcee.readthedocs.io/">emcee</a> package. This has heaps of options for running MCMC and is really user friendly. All the different available moves/samplers are listed <a class="reference external" href="https://emcee.readthedocs.io/en/stable/user/moves/">here</a>.</p>
<section id="prior">
<h3>Prior<a class="headerlink" href="#prior" title="Permalink to this heading">#</a></h3>
<p>For MCMC, we need the prior too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">neg_log_prior_bounds</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bounds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log prior that just checks proposal is in bounds</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x</span>
<span class="sd">        Parameter array</span>

<span class="sd">    bounds</span>
<span class="sd">        Bounds for each parameter (must have same</span>
<span class="sd">        order as x)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">in_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">in_bounds</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>


<span class="n">neg_log_prior</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">neg_log_prior_bounds</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bounds</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="likelihood-and-prior">
<h3>Likelihood and prior<a class="headerlink" href="#likelihood-and-prior" title="Permalink to this heading">#</a></h3>
<p>Next we create a function which returns the sum of the negative log of the likelihood and the prior for a given parameter sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">neg_log_likelihood_plus_prior_full</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">neg_log_prior</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">model_runner</span><span class="p">:</span> <span class="n">OptModelRunner</span><span class="p">,</span>
    <span class="n">cost_calculator</span><span class="p">:</span> <span class="n">OptCostCalculatorSSE</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="n">neg_log_prior_x</span> <span class="o">=</span> <span class="n">neg_log_prior</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">neg_log_prior_x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">model_results</span> <span class="o">=</span> <span class="n">model_runner</span><span class="o">.</span><span class="n">run_model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">sses</span> <span class="o">=</span> <span class="n">cost_calculator</span><span class="o">.</span><span class="n">calculate_cost</span><span class="p">(</span><span class="n">model_results</span><span class="p">)</span>
    <span class="n">neg_ll_x</span> <span class="o">=</span> <span class="o">-</span><span class="n">sses</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="n">neg_ll_x</span> <span class="o">+</span> <span class="n">neg_log_prior_x</span><span class="p">,</span> <span class="n">neg_log_prior_x</span><span class="p">,</span> <span class="n">neg_ll_x</span>


<span class="n">neg_log_likelihood_plus_prior</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
    <span class="n">neg_log_likelihood_plus_prior_full</span><span class="p">,</span>
    <span class="n">neg_log_prior</span><span class="o">=</span><span class="n">neg_log_prior</span><span class="p">,</span>
    <span class="n">model_runner</span><span class="o">=</span><span class="n">model_runner</span><span class="p">,</span>
    <span class="n">cost_calculator</span><span class="o">=</span><span class="n">cost_calculator</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="proposal">
<h3>Proposal<a class="headerlink" href="#proposal" title="Permalink to this heading">#</a></h3>
<p>Next we need to decide how we want to sample the posterior. This is often the most important, and most difficult, choice in MCMC.</p>
<p>Were using the DIME proposal from <a class="reference external" href="https://github.com/gboehl/emcwrap">emcwrap</a>. This claims to have an adaptive proposal distribution so requires less fine tuning and is less sensitive to the starting point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
<span class="c1"># emcwrap docs suggest 5 * ndim</span>
<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">ndim</span>

<span class="n">start_emcee</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">optimize_res_local</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
<span class="n">start_emcee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">start_emcee</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">move</span> <span class="o">=</span> <span class="n">DIMEMove</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="run">
<h3>Run<a class="headerlink" href="#run" title="Permalink to this heading">#</a></h3>
<p>Now were ready to run our MCMC chain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use HDF5 backend, this saves things to disk and lets</span>
<span class="c1"># you check plotting halfway through (for example)</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;basic-demo-mcmc.h5&quot;</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">HDFBackend</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">backend</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># How many parallel process to use</span>
<span class="n">processes</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Set the seed to ensure reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">485765</span><span class="p">)</span>

<span class="c1">## MCMC options</span>
<span class="c1"># Unclear at the start how many iterations are needed to sample</span>
<span class="c1"># the posterior appropriately, normally requires looking at the</span>
<span class="c1"># chains and then just running them for longer if needed.</span>
<span class="c1"># This number is about right for our toy example.</span>
<span class="n">max_iterations</span> <span class="o">=</span> <span class="mi">900</span>
<span class="n">burnin</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">thin</span> <span class="o">=</span> <span class="mi">15</span>

<span class="c1">## Visualisation options</span>
<span class="n">plot_every</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">convergence_ratio</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">parameter_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>
<span class="n">neg_log_likelihood_name</span> <span class="o">=</span> <span class="s2">&quot;neg_ll&quot;</span>
<span class="n">labels_chain</span> <span class="o">=</span> <span class="p">[</span><span class="n">neg_log_likelihood_name</span><span class="p">]</span> <span class="o">+</span> <span class="n">parameter_order</span>

<span class="c1"># Stores for autocorr over steps</span>
<span class="n">autocorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">)</span>
<span class="n">autocorr_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">## Setup plots</span>
<span class="n">fig_chain</span><span class="p">,</span> <span class="n">axd_chain</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span>
    <span class="n">mosaic</span><span class="o">=</span><span class="p">[[</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels_chain</span><span class="p">],</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">holder_chain</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="n">fig_chain</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig_dist</span><span class="p">,</span> <span class="n">axd_dist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span>
    <span class="n">mosaic</span><span class="o">=</span><span class="p">[[</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">parameter_order</span><span class="p">],</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">holder_dist</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="n">fig_dist</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig_corner</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">holder_corner</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="n">fig_dist</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig_tau</span><span class="p">,</span> <span class="n">ax_tau</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">holder_tau</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="n">fig_tau</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plottting helper</span>
<span class="n">truths_corner</span> <span class="o">=</span> <span class="p">[</span><span class="n">truth</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>

<span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">sampler</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span>
        <span class="n">nwalkers</span><span class="p">,</span>
        <span class="n">ndim</span><span class="p">,</span>
        <span class="n">neg_log_likelihood_plus_prior</span><span class="p">,</span>
        <span class="n">moves</span><span class="o">=</span><span class="n">move</span><span class="p">,</span>
        <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
        <span class="n">blobs_dtype</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;neg_log_prior&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;neg_log_likelihood&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)],</span>
        <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="c1"># If statement in case we&#39;re continuing a run rather than starting fresh</span>
        <span class="n">start_emcee</span> <span class="k">if</span> <span class="n">sampler</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_last_sample</span><span class="p">(),</span>
        <span class="n">iterations</span><span class="o">=</span><span class="n">max_iterations</span><span class="p">,</span>
        <span class="n">progress</span><span class="o">=</span><span class="s2">&quot;notebook&quot;</span><span class="p">,</span>
        <span class="n">progress_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;leave&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">sampler</span><span class="o">.</span><span class="n">iteration</span> <span class="o">%</span> <span class="n">plot_every</span> <span class="ow">or</span> <span class="n">sampler</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">sampler</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&lt;</span> <span class="n">burnin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">in_burn_in</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_burn_in</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axd_chain</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">emcee_plotting</span><span class="o">.</span><span class="n">plot_chains</span><span class="p">(</span>
            <span class="n">inp</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span>
            <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
            <span class="n">parameter_order</span><span class="o">=</span><span class="n">parameter_order</span><span class="p">,</span>
            <span class="n">axes_d</span><span class="o">=</span><span class="n">axd_chain</span><span class="p">,</span>
            <span class="n">neg_log_likelihood_name</span><span class="o">=</span><span class="n">neg_log_likelihood_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig_chain</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">holder_chain</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fig_chain</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_burn_in</span><span class="p">:</span>
            <span class="n">chain_post_burnin</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="n">burnin</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chain_post_burnin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">acceptance_fraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                    <span class="n">get_acceptance_fractions</span><span class="p">(</span><span class="n">chain_post_burnin</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">chain_post_burnin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> steps post burnin, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;acceptance fraction: </span><span class="si">{</span><span class="n">acceptance_fraction</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axd_dist</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="n">emcee_plotting</span><span class="o">.</span><span class="n">plot_dist</span><span class="p">(</span>
                <span class="n">inp</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span>
                <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
                <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span>
                <span class="n">parameter_order</span><span class="o">=</span><span class="n">parameter_order</span><span class="p">,</span>
                <span class="n">axes_d</span><span class="o">=</span><span class="n">axd_dist</span><span class="p">,</span>
                <span class="n">warn_singular</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig_dist</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">holder_dist</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fig_dist</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">fig_corner</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">emcee_plotting</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span>
                    <span class="n">inp</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span>
                    <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
                    <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span>
                    <span class="n">parameter_order</span><span class="o">=</span><span class="n">parameter_order</span><span class="p">,</span>
                    <span class="n">fig</span><span class="o">=</span><span class="n">fig_corner</span><span class="p">,</span>
                    <span class="n">truths</span><span class="o">=</span><span class="n">truths_corner</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">fig_corner</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">holder_corner</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fig_corner</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">autocorr_bits</span> <span class="o">=</span> <span class="n">get_autocorrelation_info</span><span class="p">(</span>
                <span class="n">sampler</span><span class="p">,</span>
                <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
                <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span>
                <span class="n">autocorr_tol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">convergence_ratio</span><span class="o">=</span><span class="n">convergence_ratio</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">autocorr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">autocorr_bits</span><span class="p">[</span><span class="s2">&quot;autocorr&quot;</span><span class="p">]</span>
            <span class="n">autocorr_steps</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">iteration</span> <span class="o">-</span> <span class="n">burnin</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">autocorr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">autocorr</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># plot autocorrelation, pretty specific to setup so haven&#39;t</span>
                <span class="c1"># created separate function</span>
                <span class="n">ax_tau</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">ax_tau</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">autocorr_steps</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span>
                    <span class="n">autocorr</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ax_tau</span><span class="o">.</span><span class="n">axline</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">convergence_ratio</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span>
                <span class="p">)</span>
                <span class="n">ax_tau</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean tau&quot;</span><span class="p">)</span>
                <span class="n">ax_tau</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number steps (post burnin)&quot;</span><span class="p">)</span>
                <span class="n">holder_tau</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fig_tau</span><span class="p">)</span>

<span class="c1"># Close all the figures</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ae83a365a542ce6c91071298c87b07059614256a926e2f9b91b8f642800ef7f0.png" src="../_images/ae83a365a542ce6c91071298c87b07059614256a926e2f9b91b8f642800ef7f0.png" />
<img alt="../_images/e0787053746aed411b04d5e02932b186ea82b3ad4db648c85cd64ecd7fd6df51.png" src="../_images/e0787053746aed411b04d5e02932b186ea82b3ad4db648c85cd64ecd7fd6df51.png" />
<img alt="../_images/1ec5ff954f28ed0e0ad6229cbe6cfc6e0b89da921c49e450fe668de43674d3d6.png" src="../_images/1ec5ff954f28ed0e0ad6229cbe6cfc6e0b89da921c49e450fe668de43674d3d6.png" />
<img alt="../_images/5be39d398896f4d1ee6314a52eda11f90e916422a7a459c2790fc2fcdaf1c315.png" src="../_images/5be39d398896f4d1ee6314a52eda11f90e916422a7a459c2790fc2fcdaf1c315.png" />
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "589510770f9e4d62b64413c40f878567"}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50 steps post burnin, acceptance fraction: 0.3863945578231292
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100 steps post burnin, acceptance fraction: 0.39191919191919194
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>150 steps post burnin, acceptance fraction: 0.37941834451901557
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200 steps post burnin, acceptance fraction: 0.38190954773869346
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/OpenSCM-Calibration_examples/OpenSCM-Calibration_examples/.venv/lib/python3.9/site-packages/emcwrap/moves.py:91: RuntimeWarning: divide by zero encountered in log
  np.log(sum(self.accepted)) - np.log(nchain)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250 steps post burnin, acceptance fraction: 0.3825970548862116
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>300 steps post burnin, acceptance fraction: 0.382608695652174
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>350 steps post burnin, acceptance fraction: 0.3797516714422159
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>400 steps post burnin, acceptance fraction: 0.3752715121136173
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>450 steps post burnin, acceptance fraction: 0.3752041573867854
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>500 steps post burnin, acceptance fraction: 0.3766199064796259
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>550 steps post burnin, acceptance fraction: 0.3757134183363692
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>600 steps post burnin, acceptance fraction: 0.3774067890929326
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>650 steps post burnin, acceptance fraction: 0.3784283513097073
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>700 steps post burnin, acceptance fraction: 0.3766332856461612
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>750 steps post burnin, acceptance fraction: 0.37561192701379625
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>800 steps post burnin, acceptance fraction: 0.3734668335419274
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show the assertion we use in testing</span>
<span class="expanded">Hide the assertion we use in testing</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">autocorr_bits</span><span class="p">[</span><span class="s2">&quot;converged&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>In this case, our MCMC converges nicely (although convergence is of course not an exact science).</p>
</section>
</section>
<section id="plotting-a-live-run">
<h2>Plotting a live run<a class="headerlink" href="#plotting-a-live-run" title="Permalink to this heading">#</a></h2>
<p>If we run an MCMC chain with an HDF5 backend, we can plot it after the chain has finished or even while the chain is running (this can fail if the HDF5 read is at just the wrong time, but this is very rare in our experience and is solved by <a class="github reference external" href="https://github.com/dfm/emcee/pull/395">dfm/emcee#395</a> (check if this has been merged and update appropriately)). The cells below how to make such plots. You could also run them in a standalone notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reader</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">HDFBackend</span><span class="p">(</span><span class="s2">&quot;basic-demo-mcmc.h5&quot;</span><span class="p">)</span>

<span class="n">burnin</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">thin</span> <span class="o">=</span> <span class="mi">12</span>

<span class="c1"># You do have to know the parameter order used by your</span>
<span class="c1"># backend. Creating a new backend which stored this too</span>
<span class="c1"># would be a nice PR into openscm-calibration.</span>
<span class="n">parameter_order</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;x_zero&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">neg_log_likelihood_name</span> <span class="o">=</span> <span class="s2">&quot;neg_ll&quot;</span>
<span class="n">labels_chain</span> <span class="o">=</span> <span class="p">[</span><span class="n">neg_log_likelihood_name</span><span class="p">]</span> <span class="o">+</span> <span class="n">parameter_order</span>

<span class="n">fig_chain</span><span class="p">,</span> <span class="n">axd_chain</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span>
    <span class="n">mosaic</span><span class="o">=</span><span class="p">[[</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels_chain</span><span class="p">],</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">fig_dist</span><span class="p">,</span> <span class="n">axd_dist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span>
    <span class="n">mosaic</span><span class="o">=</span><span class="p">[[</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">parameter_order</span><span class="p">],</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">fig_corner</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>


<span class="n">emcee_plotting</span><span class="o">.</span><span class="n">plot_chains</span><span class="p">(</span>
    <span class="n">inp</span><span class="o">=</span><span class="n">reader</span><span class="p">,</span>
    <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
    <span class="n">parameter_order</span><span class="o">=</span><span class="n">parameter_order</span><span class="p">,</span>
    <span class="n">axes_d</span><span class="o">=</span><span class="n">axd_chain</span><span class="p">,</span>
    <span class="n">neg_log_likelihood_name</span><span class="o">=</span><span class="n">neg_log_likelihood_name</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">emcee_plotting</span><span class="o">.</span><span class="n">plot_dist</span><span class="p">(</span>
    <span class="n">inp</span><span class="o">=</span><span class="n">reader</span><span class="p">,</span>
    <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
    <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span>
    <span class="n">parameter_order</span><span class="o">=</span><span class="n">parameter_order</span><span class="p">,</span>
    <span class="n">axes_d</span><span class="o">=</span><span class="n">axd_dist</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">emcee_plotting</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span>
    <span class="n">inp</span><span class="o">=</span><span class="n">reader</span><span class="p">,</span>
    <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
    <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span>
    <span class="n">parameter_order</span><span class="o">=</span><span class="n">parameter_order</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">fig_corner</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig_chain</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_dist</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_corner</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Number thinned samples per chain: </span><span class="si">{</span><span class="n">reader</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span><span class="w"> </span><span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span><span class="w"> </span><span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Number thinned samples: </span><span class="si">{</span><span class="n">reader</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span><span class="w"> </span><span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span><span class="w"> </span><span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>

<span class="n">autocorr_bits</span> <span class="o">=</span> <span class="n">get_autocorrelation_info</span><span class="p">(</span>
    <span class="n">reader</span><span class="p">,</span> <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span> <span class="n">autocorr_tol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">convergence_ratio</span><span class="o">=</span><span class="mi">50</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">autocorr_bits</span><span class="p">[</span><span class="s1">&#39;autocorr&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">autocorr_bits</span><span class="p">[</span><span class="s1">&#39;convergence_ratio&#39;</span><span class="p">]</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">autocorr_bits</span><span class="p">[</span><span class="s1">&#39;steps_post_burnin&#39;</span><span class="p">]</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converged? </span><span class="si">{</span><span class="n">autocorr_bits</span><span class="p">[</span><span class="s1">&#39;converged&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number thinned samples per chain: 66
Number thinned samples: 990
autocorr_bits[&#39;autocorr&#39;] * autocorr_bits[&#39;convergence_ratio&#39;]=505.0365910592537
autocorr_bits[&#39;steps_post_burnin&#39;]=800
Converged? True
</pre></div>
</div>
<img alt="../_images/b57e950eee859b5ef2f8d5286ae486fcf47f3ea25798115a63ffdd723dc0234b.png" src="../_images/b57e950eee859b5ef2f8d5286ae486fcf47f3ea25798115a63ffdd723dc0234b.png" />
<img alt="../_images/2c9402f57810da2ce1a1b3fa10092a4b40a6493ddfffd209f37937b44984b665.png" src="../_images/2c9402f57810da2ce1a1b3fa10092a4b40a6493ddfffd209f37937b44984b665.png" />
<img alt="../_images/94c99ebaf2729d7db53f033dfd7f1c00c43c2f53dbb0fef97e451a1b4a2a9c05.png" src="../_images/94c99ebaf2729d7db53f033dfd7f1c00c43c2f53dbb0fef97e451a1b4a2a9c05.png" />
</div>
</div>
</section>
<section id="adding-degeneracy">
<h2>Adding degeneracy<a class="headerlink" href="#adding-degeneracy" title="Permalink to this heading">#</a></h2>
<p>Sometimes, our model parameters are underconstrained. For our toy example here, we can make this the case by adding the models mass into the parameters to constrain. If we do this and run the MCMC again, we can see this degeneracy appear. Such a degeneracy would also cause issues for our optimisation, as equally good fits could be found with different parameter values. This is something to keep in mind and is a good reason to run MCMC after optimisation (i.e. the MCMC should be run as a check because it will reveal degeneracy that optimisation alone will not).</p>
<section id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">truth_incl_mass</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="s2">&quot;kg / s^2&quot;</span><span class="p">),</span>
    <span class="s2">&quot;x_zero&quot;</span><span class="p">:</span> <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">),</span>
    <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1e11</span><span class="p">,</span> <span class="s2">&quot;kg / s&quot;</span><span class="p">),</span>
    <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="s2">&quot;Pt&quot;</span><span class="p">),</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;truth_incl_mass&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">truth_incl_mass</span><span class="p">)</span>

<span class="n">target_incl_mass</span> <span class="o">=</span> <span class="n">do_experiments_full</span><span class="p">(</span><span class="o">**</span><span class="n">truth_incl_mass</span><span class="p">)</span>
<span class="n">target_incl_mass</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span>
<span class="n">target_incl_mass</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">time_axis</span><span class="o">=</span><span class="s2">&quot;year-month&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">parameters_incl_mass</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MASS_UNITS</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">TIME_UNITS</span><span class="si">}</span><span class="s2"> ^ 2&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;x_zero&quot;</span><span class="p">,</span> <span class="n">LENGTH_UNITS</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MASS_UNITS</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">TIME_UNITS</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">MASS_UNITS</span><span class="p">),</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">parameters_incl_mass</span><span class="p">)</span>
<span class="n">parameter_order_incl_mass</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parameters_incl_mass</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">do_model_runs_input_generator_incl_mass</span><span class="p">(</span>
    <span class="n">k</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">x_zero</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create the inputs for :func:`do_experiments`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k</span>
<span class="sd">        k</span>

<span class="sd">    x_zero</span>
<span class="sd">        x_zero</span>

<span class="sd">    beta</span>
<span class="sd">        beta</span>

<span class="sd">    m</span>
<span class="sd">        Mass</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        Inputs for :func:`do_experiments`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;x_zero&quot;</span><span class="p">:</span> <span class="n">x_zero</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="n">beta</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="n">m</span><span class="p">}</span>


<span class="n">model_runner_incl_mass</span> <span class="o">=</span> <span class="n">OptModelRunner</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span>
    <span class="n">params</span><span class="o">=</span><span class="n">parameters_incl_mass</span><span class="p">,</span>
    <span class="n">do_model_runs_input_generator</span><span class="o">=</span><span class="n">do_model_runs_input_generator_incl_mass</span><span class="p">,</span>
    <span class="n">do_model_runs</span><span class="o">=</span><span class="n">do_experiments_full</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model runner&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">model_runner_incl_mass</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Example cost&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span>
    <span class="n">cost_calculator</span><span class="o">.</span><span class="n">calculate_cost</span><span class="p">(</span><span class="n">model_runner_incl_mass</span><span class="o">.</span><span class="n">run_model</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>
<span class="p">)</span>

<span class="n">bounds_dict_incl_mass</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;kg / s^2&quot;</span><span class="p">),</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1e4</span><span class="p">,</span> <span class="s2">&quot;kg / s^2&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;x_zero&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">),</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1e10</span><span class="p">,</span> <span class="s2">&quot;kg / s&quot;</span><span class="p">),</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1e12</span><span class="p">,</span> <span class="s2">&quot;kg / s&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Pt&quot;</span><span class="p">),</span>
        <span class="n">UREG</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;Pt&quot;</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bounds dictionary&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">bounds_dict_incl_mass</span><span class="p">)</span>

<span class="n">bounds_incl_mass</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bounds_dict_incl_mass</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">parameters_incl_mass</span>
<span class="p">]</span>
<span class="n">neg_log_prior_incl_mass</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
    <span class="n">neg_log_prior_bounds</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bounds_incl_mass</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">neg_log_likelihood_plus_prior_incl_mass</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
    <span class="n">neg_log_likelihood_plus_prior_full</span><span class="p">,</span>
    <span class="n">neg_log_prior</span><span class="o">=</span><span class="n">neg_log_prior_incl_mass</span><span class="p">,</span>
    <span class="n">model_runner</span><span class="o">=</span><span class="n">model_runner_incl_mass</span><span class="p">,</span>
    <span class="n">cost_calculator</span><span class="o">=</span><span class="n">cost_calculator</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">ndim_incl_mass</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounds_incl_mass</span><span class="p">)</span>
<span class="n">nwalkers_incl_mass</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">ndim_incl_mass</span>

<span class="n">start_emcee_incl_mass</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">start_emcee_incl_mass</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">s</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">nwalkers_incl_mass</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">start_emcee_incl_mass</span>
<span class="p">]</span>
<span class="n">start_emcee_incl_mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">start_emcee_incl_mass</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">move_incl_mass</span> <span class="o">=</span> <span class="n">DIMEMove</span><span class="p">()</span>

<span class="c1"># Use HDF5 backend, this saves things to disk and lets</span>
<span class="c1"># you check plotting halfway through (for example)</span>
<span class="n">filename_incl_mass</span> <span class="o">=</span> <span class="s2">&quot;basic-demo-mcmc_incl-mass.h5&quot;</span>
<span class="n">backend_incl_mass</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">HDFBackend</span><span class="p">(</span><span class="n">filename_incl_mass</span><span class="p">)</span>
<span class="n">backend_incl_mass</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">nwalkers_incl_mass</span><span class="p">,</span> <span class="n">ndim_incl_mass</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>truth_incl_mass
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;k&#39;: 3000 &lt;Unit(&#39;kilogram / second ** 2&#39;)&gt;,
 &#39;x_zero&#39;: 0.5 &lt;Unit(&#39;meter&#39;)&gt;,
 &#39;beta&#39;: 100000000000.0 &lt;Unit(&#39;kilogram / second&#39;)&gt;,
 &#39;m&#39;: 120 &lt;Unit(&#39;petametric_ton&#39;)&gt;}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/OpenSCM-Calibration_examples/OpenSCM-Calibration_examples/.venv/lib/python3.9/site-packages/scmdata/plotting.py:79: FutureWarning: 

The `ci` parameter is deprecated. Use `errorbar=&#39;sd&#39;` for the same effect.

  ax = sns.lineplot(data=plt_df, **kwargs)
</pre></div>
</div>
<img alt="../_images/9daa75fe58ac859a9522b49567ee58377b08f0f09551bbb5b538e702e009d63a.png" src="../_images/9daa75fe58ac859a9522b49567ee58377b08f0f09551bbb5b538e702e009d63a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>parameters
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;k&#39;, &#39;Pt / yr ^ 2&#39;), (&#39;x_zero&#39;, &#39;m&#39;), (&#39;beta&#39;, &#39;Pt / yr&#39;), (&#39;m&#39;, &#39;Pt&#39;)]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model runner
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OptModelRunner(convert_x_to_names_with_units=functools.partial(&lt;function x_and_parameters_to_named_with_units at 0x7f2db97edee0&gt;, params=[(&#39;k&#39;, &#39;Pt / yr ^ 2&#39;), (&#39;x_zero&#39;, &#39;m&#39;), (&#39;beta&#39;, &#39;Pt / yr&#39;), (&#39;m&#39;, &#39;Pt&#39;)]), do_model_runs_input_generator=&lt;function do_model_runs_input_generator_incl_mass at 0x7f2dac5705e0&gt;, do_model_runs=&lt;function do_experiments_full at 0x7f2db980b280&gt;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Example cost
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5478.551430424355
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bounds dictionary
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;k&#39;: [300 &lt;Unit(&#39;kilogram / second ** 2&#39;)&gt;,
  10000.0 &lt;Unit(&#39;kilogram / second ** 2&#39;)&gt;],
 &#39;x_zero&#39;: [-2 &lt;Unit(&#39;meter&#39;)&gt;, 2 &lt;Unit(&#39;meter&#39;)&gt;],
 &#39;beta&#39;: [10000000000.0 &lt;Unit(&#39;kilogram / second&#39;)&gt;,
  1000000000000.0 &lt;Unit(&#39;kilogram / second&#39;)&gt;],
 &#39;m&#39;: [10 &lt;Unit(&#39;petametric_ton&#39;)&gt;, 1000 &lt;Unit(&#39;petametric_ton&#39;)&gt;]}
</pre></div>
</div>
</div>
</div>
</section>
<section id="re-running-the-mcmc">
<h3>Re-running the MCMC<a class="headerlink" href="#re-running-the-mcmc" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">processes</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">max_iterations</span> <span class="o">=</span> <span class="mi">900</span>
<span class="n">burnin</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">thin</span> <span class="o">=</span> <span class="mi">15</span>

<span class="c1">## Visualisation options</span>
<span class="n">plot_every</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">convergence_ratio</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">labels_chain_incl_mass</span> <span class="o">=</span> <span class="p">[</span><span class="n">neg_log_likelihood_name</span><span class="p">]</span> <span class="o">+</span> <span class="n">parameter_order_incl_mass</span>

<span class="c1"># Stores for autocorr over steps</span>
<span class="n">autocorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">)</span>
<span class="n">autocorr_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">## Setup plots</span>
<span class="n">fig_chain_incl_mass</span><span class="p">,</span> <span class="n">axd_chain_incl_mass</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span>
    <span class="n">mosaic</span><span class="o">=</span><span class="p">[[</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels_chain_incl_mass</span><span class="p">],</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">holder_chain_incl_mass</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="n">fig_chain_incl_mass</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig_dist_incl_mass</span><span class="p">,</span> <span class="n">axd_dist_incl_mass</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span>
    <span class="n">mosaic</span><span class="o">=</span><span class="p">[[</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">parameter_order_incl_mass</span><span class="p">],</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">holder_dist_incl_mass</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="n">fig_dist_incl_mass</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig_corner_incl_mass</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">holder_corner_incl_mass</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="n">fig_dist_incl_mass</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig_tau_incl_mass</span><span class="p">,</span> <span class="n">ax_tau_incl_mass</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">holder_tau_incl_mass</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="n">fig_tau_incl_mass</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">truths_corner_incl_mass</span> <span class="o">=</span> <span class="p">[</span><span class="n">truth_incl_mass</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">m</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">parameters_incl_mass</span><span class="p">]</span>

<span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">processes</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">sampler</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span>
        <span class="n">nwalkers_incl_mass</span><span class="p">,</span>
        <span class="n">ndim_incl_mass</span><span class="p">,</span>
        <span class="n">neg_log_likelihood_plus_prior_incl_mass</span><span class="p">,</span>
        <span class="n">moves</span><span class="o">=</span><span class="n">move_incl_mass</span><span class="p">,</span>
        <span class="n">backend</span><span class="o">=</span><span class="n">backend_incl_mass</span><span class="p">,</span>
        <span class="n">blobs_dtype</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;neg_log_prior&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;neg_log_likelihood&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)],</span>
        <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">start_emcee_incl_mass</span> <span class="k">if</span> <span class="n">sampler</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_last_sample</span><span class="p">(),</span>
        <span class="n">iterations</span><span class="o">=</span><span class="n">max_iterations</span><span class="p">,</span>
        <span class="n">progress</span><span class="o">=</span><span class="s2">&quot;notebook&quot;</span><span class="p">,</span>
        <span class="n">progress_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;leave&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">sampler</span><span class="o">.</span><span class="n">iteration</span> <span class="o">%</span> <span class="n">plot_every</span> <span class="ow">or</span> <span class="n">sampler</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">sampler</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&lt;</span> <span class="n">burnin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">in_burn_in</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">in_burn_in</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axd_chain_incl_mass</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">emcee_plotting</span><span class="o">.</span><span class="n">plot_chains</span><span class="p">(</span>
            <span class="n">inp</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span>
            <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
            <span class="n">parameter_order</span><span class="o">=</span><span class="n">parameter_order_incl_mass</span><span class="p">,</span>
            <span class="n">axes_d</span><span class="o">=</span><span class="n">axd_chain_incl_mass</span><span class="p">,</span>
            <span class="n">neg_log_likelihood_name</span><span class="o">=</span><span class="n">neg_log_likelihood_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fig_chain_incl_mass</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">holder_chain_incl_mass</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fig_chain_incl_mass</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_burn_in</span><span class="p">:</span>
            <span class="n">chain_post_burnin</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="n">burnin</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chain_post_burnin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">acceptance_fraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                    <span class="n">get_acceptance_fractions</span><span class="p">(</span><span class="n">chain_post_burnin</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">chain_post_burnin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> steps post burnin, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;acceptance fraction: </span><span class="si">{</span><span class="n">acceptance_fraction</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axd_dist_incl_mass</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="n">emcee_plotting</span><span class="o">.</span><span class="n">plot_dist</span><span class="p">(</span>
                <span class="n">inp</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span>
                <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
                <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span>
                <span class="n">parameter_order</span><span class="o">=</span><span class="n">parameter_order_incl_mass</span><span class="p">,</span>
                <span class="n">axes_d</span><span class="o">=</span><span class="n">axd_dist_incl_mass</span><span class="p">,</span>
                <span class="n">warn_singular</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">fig_dist_incl_mass</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">holder_dist_incl_mass</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fig_dist_incl_mass</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">fig_corner_incl_mass</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">emcee_plotting</span><span class="o">.</span><span class="n">plot_corner</span><span class="p">(</span>
                    <span class="n">inp</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span>
                    <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
                    <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span>
                    <span class="n">parameter_order</span><span class="o">=</span><span class="n">parameter_order_incl_mass</span><span class="p">,</span>
                    <span class="n">fig</span><span class="o">=</span><span class="n">fig_corner_incl_mass</span><span class="p">,</span>
                    <span class="n">truths</span><span class="o">=</span><span class="n">truths_corner_incl_mass</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">fig_corner_incl_mass</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">holder_corner_incl_mass</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fig_corner_incl_mass</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">autocorr_bits</span> <span class="o">=</span> <span class="n">get_autocorrelation_info</span><span class="p">(</span>
                <span class="n">sampler</span><span class="p">,</span>
                <span class="n">burnin</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span>
                <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span>
                <span class="n">autocorr_tol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">convergence_ratio</span><span class="o">=</span><span class="n">convergence_ratio</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">autocorr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">autocorr_bits</span><span class="p">[</span><span class="s2">&quot;autocorr&quot;</span><span class="p">]</span>
            <span class="n">autocorr_steps</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">iteration</span> <span class="o">-</span> <span class="n">burnin</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">autocorr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">autocorr</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax_tau_incl_mass</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">ax_tau_incl_mass</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">autocorr_steps</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span>
                    <span class="n">autocorr</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ax_tau_incl_mass</span><span class="o">.</span><span class="n">axline</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">convergence_ratio</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span>
                <span class="p">)</span>
                <span class="n">ax_tau_incl_mass</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean tau&quot;</span><span class="p">)</span>
                <span class="n">ax_tau_incl_mass</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number steps (post burnin)&quot;</span><span class="p">)</span>
                <span class="n">holder_tau_incl_mass</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fig_tau_incl_mass</span><span class="p">)</span>

<span class="c1"># Close all the figures</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fa1e5a7cbfa9ca09c9ca4876037e29fe5c400a18a90da668b0d78f864df5d009.png" src="../_images/fa1e5a7cbfa9ca09c9ca4876037e29fe5c400a18a90da668b0d78f864df5d009.png" />
<img alt="../_images/4744d30156c6a04fef84abd4b21992480057772f0e8dc627ada64de0cb22c629.png" src="../_images/4744d30156c6a04fef84abd4b21992480057772f0e8dc627ada64de0cb22c629.png" />
<img alt="../_images/a3cf5fd9cdf9005dd260a29f7172cc45e91035c596084cc4137483cc64cacfb6.png" src="../_images/a3cf5fd9cdf9005dd260a29f7172cc45e91035c596084cc4137483cc64cacfb6.png" />
<img alt="../_images/08bb849af9bc97e3339cd1b492b4a2d4b02c19260fbad377a0273fcf035bb3da.png" src="../_images/08bb849af9bc97e3339cd1b492b4a2d4b02c19260fbad377a0273fcf035bb3da.png" />
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "65f9b797855f4867960641e1bd5dea4a"}</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/OpenSCM-Calibration_examples/OpenSCM-Calibration_examples/.venv/lib/python3.9/site-packages/emcwrap/moves.py:91: RuntimeWarning: divide by zero encountered in log
  np.log(sum(self.accepted)) - np.log(nchain)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50 steps post burnin, acceptance fraction: 0.2510204081632653
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100 steps post burnin, acceptance fraction: 0.27676767676767683
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>150 steps post burnin, acceptance fraction: 0.27449664429530196
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200 steps post burnin, acceptance fraction: 0.27839195979899495
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250 steps post burnin, acceptance fraction: 0.2809236947791165
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>300 steps post burnin, acceptance fraction: 0.2777591973244148
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>350 steps post burnin, acceptance fraction: 0.2756446991404012
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>400 steps post burnin, acceptance fraction: 0.2768170426065163
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>450 steps post burnin, acceptance fraction: 0.2755011135857461
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>500 steps post burnin, acceptance fraction: 0.2762525050100201
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>550 steps post burnin, acceptance fraction: 0.2760473588342441
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>600 steps post burnin, acceptance fraction: 0.27879799666110183
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>650 steps post burnin, acceptance fraction: 0.27919876733436055
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>700 steps post burnin, acceptance fraction: 0.2753934191702432
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/OpenSCM-Calibration_examples/OpenSCM-Calibration_examples/.venv/lib/python3.9/site-packages/emcwrap/moves.py:91: RuntimeWarning: divide by zero encountered in log
  np.log(sum(self.accepted)) - np.log(nchain)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>750 steps post burnin, acceptance fraction: 0.2734312416555408
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/OpenSCM-Calibration_examples/OpenSCM-Calibration_examples/.venv/lib/python3.9/site-packages/emcwrap/moves.py:91: RuntimeWarning: divide by zero encountered in log
  np.log(sum(self.accepted)) - np.log(nchain)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>800 steps post burnin, acceptance fraction: 0.2722778473091364
</pre></div>
</div>
</div>
</div>
<p>Thanks to the MCMC chain, the degeneracy between <span class="math notranslate nohighlight">\(m\)</span>, <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> is obvious. We dont get much information about the parameter values from the calibration because of the degeneracy, and this shows up in the probability distributions which dont have clear peaks (the uncertainty on the parameter values except <span class="math notranslate nohighlight">\(x_0\)</span> is very large). In this case they are hitting up against the bounds but they really could end up anywhere because the true probability distributions are very flat. In such cases, we have to be careful about how we interpret such plots. As we can see, the truth is inside the distribution, but it isnt where the mode of the distribution is. If youre parameters look like theyre hitting your bounds, it is a good sign that something isnt going as planned.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">OpenSCM-Calibration Examples</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#experiments">Experiments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#target">Target</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cost-calculation">Cost calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-runner">Model runner</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-optimisation">Global optimisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#local-optimisation">Local optimisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mcmc">MCMC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prior">Prior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#likelihood-and-prior">Likelihood and prior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proposal">Proposal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run">Run</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-a-live-run">Plotting a live run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-degeneracy">Adding degeneracy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#re-running-the-mcmc">Re-running the MCMC</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Zebedee Nicholls
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>